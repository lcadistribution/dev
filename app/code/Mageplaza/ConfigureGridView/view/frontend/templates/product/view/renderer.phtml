<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_ConfigureGridView
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

use Mageplaza\ConfigureGridView\Block\Product\Renderer\Configurable;
use Magento\Swatches\Block\Product\Renderer\Configurable as SwatchesConfigurable;
use Mageplaza\ConfigureGridView\Helper\Data;
?>
<?php /** @var $block Configurable */ ?>
<?php if ($block->isEnable()) : ?>
    <div id="mpcpgv-detail">
        <div id="mpcpgv-detail-title">
            <button type="reset" class="mpcpgv-reset"><span><?= $block->escapeHtml(__('Reset')) ?></span></button>
        </div>
        <div id="mpcpgv-overflow">
            <table id="mpcpgv-simple-product">
                <thead>
                <tr>
                    <td><?= $block->escapeHtml(__('SKU')) ?></td>
                    <td><?= $block->escapeHtml(__('Attribute')) ?></td>
                    <td><?= $block->escapeHtml(__('Qty')) ?></td>
                    <td></td>
                </tr>
                </thead>
            </table>
        </div>
        <hr>
        <div id="mpcpgv-detail-total">
            <div>
                <div class="mpcpgv-detail-label"><?= $block->escapeHtml(__('Total Qty')) ?></div>
                <div class="mpcpgv-detail-qty">0</div>
            </div>
            <br>
            <div class="mpcpgv-style-total">
                <div class="mpcpgv-detail-label"><?= $block->escapeHtml(__('Total')) ?></div>
                <div class="mpcpgv-detail-sum">0</div>
            </div>
        </div>
        <hr>
    </div>
    <div id="mpcpgv-attribute-inactive" class="mpcpgv-attribute-inactive"></div>
    <div class="swatch-opt" data-role="swatch-options"
         data-mage-init='{"Mageplaza_ConfigureGridView/js/swatch-renderer": {
            "jsonConfig": <?= /* @noEscape */ $swatchOptions = $block->getJsonConfig() ?>,
            "jsonSwatchConfig": <?= /* @noEscape */ $swatchOptions = $block->getJsonSwatchConfig() ?>,
            "mediaCallback": "<?= /* @noEscape */ $block->getMediaCallback() ?>",
            "gallerySwitchStrategy": "<?= /* @noEscape */ $block->getVar('gallery_switch_strategy', 'Magento_ConfigurableProduct') ?: 'replace' ?>",
            "jsonSwatchImageSizeConfig": <?= /* @noEscape */ $block->getJsonSwatchSizeConfig() ?>,"childData": <?= /* @noEscape */ Data::jsonEncode($block->getChildProductData()) ?>,
            "addToWishlistUrl": "<?= /** @noEscape */ $block->getUrl('mpcpgv/customer/addtowishlist', ['_current' => true, 'form_key' => $block->getFormKey()]) ?>"
            }}'>
        <table id="mpcpgv-attribute-table">
            <thead>
            <tr>
                <td></td>
                <?php foreach ($block->getAttributeGridView() as $value) : ?>

                    <td>
                        <div id="<?= $block->escapeHtmlAttr($value['code']) ?>" class="mpcpgv-attribute-sort">
                            <?= $block->escapeHtml($value['label']) ?>
                            <?php if ($block->sortEnabled()) : ?>
                            <span class="mpcpgv-sort mpcpgv-sort-asc"></span>
                            <span class="mpcpgv-sort mpcpgv-sort-desc"></span>
                            <?php endif; ?>
                        </div>
                    </td>
                <?php endforeach; ?>
                <?php foreach ($block->getDefaultColumns() as $key => $label) : ?>
                    <td id="<?= $block->escapeHtmlAttr($key) ?>" display-id="<?= $block->escapeHtmlAttr($key) ?>" <?php if ($key == '2') : ?> style="text-align: right" <?php endif; ?>  ><?= $block->escapeHtml($label) ?></td>
                <?php endforeach; ?>
                <td><?= $block->escapeHtml(__('Qty')) ?></td>
            </tr>
            </thead>
            <tbody>
            </tbody>
        </table>
        <style>
            .swatch-opt {
                overflow: auto;
            }
        </style>
    </div>
    <script type="text/x-magento-init">
    {
        "*" : {
            "Magento_Swatches/js/catalog-add-to-cart": {}
        }
    }
    </script>
<?php else : ?>
    <?php /** @var $block SwatchesConfigurable */ ?>
    <div class="swatch-opt" data-role="swatch-options"
         data-mage-init='{"Magento_Swatches/js/swatch-renderer":{
         "jsonConfig": <?= /* @escapeNotVerified */ $swatchOptions = $block->getJsonConfig() ?>,
         "jsonSwatchConfig": <?= /* @escapeNotVerified */ $swatchOptions = $block->getJsonSwatchConfig(); ?>,
         "mediaCallback": "<?= /* @escapeNotVerified */ $block->getMediaCallback() ?>",
         "gallerySwitchStrategy": "<?= /* @escapeNotVerified */ $block->getVar('gallery_switch_strategy', 'Magento_ConfigurableProduct') ?: 'replace'; ?>",
         "jsonSwatchImageSizeConfig": <?= /* @noEscape */ $block->getJsonSwatchSizeConfig() ?>
         }}'></div>
    <script type="text/x-magento-init">
        {
            "*" : {
                "Magento_Swatches/js/catalog-add-to-cart": {}
            }
        }
    </script>
<?php endif; ?>


<script>// <![CDATA[
    require([
        'jquery'
    ], function ($) {

        $(document).ready(function() {
        $('#product-addtocart-button').attr('disabled', 'disabled');
        });


        $("table#mpcpgv-attribute-table").on("click","a.add", function(event){


            event.preventDefault();

            let conditionnemment = $(this).data('conditionnemment');

            var row = $(this).closest("tr");
            let currentVal =  parseInt(row.find('input').val());

            let myinput = row.find('input');

            if (currentVal == '1')
            {
                myinput.val(conditionnemment);

            } else {

                myinput.val(currentVal + conditionnemment);
            }

            $('#product-addtocart-button').removeAttr('disabled');

            });



    });
    // ]]>
</script>



