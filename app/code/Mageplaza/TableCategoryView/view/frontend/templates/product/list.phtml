<?php
/**
 * Mageplaza
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Mageplaza.com license that is
 * available through the world-wide-web at this URL:
 * https://www.mageplaza.com/LICENSE.txt
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Mageplaza
 * @package     Mageplaza_TableCategoryView
 * @copyright   Copyright (c) Mageplaza (https://www.mageplaza.com/)
 * @license     https://www.mageplaza.com/LICENSE.txt
 */

use Magento\Catalog\Block\Product\ReviewRendererInterface;
use Magento\Catalog\Helper\Output;
use Magento\Catalog\Model\Product;
use Magento\Framework\App\Action\Action;
use Mageplaza\TableCategoryView\Block\CatalogProduct\ListProduct;

?>

<?php
/** @var ListProduct $block */
$_productCollection = $block->getLoadedProductCollection();
/** @var Output $_helper */
$_helper = $block->getOutputHelper();
$cfpEnable = $block->checkModuleIsEnable('Mageplaza_CallForPrice');
$rfqShow = $block->checkModuleIsEnable('Mageplaza_RequestForQuote');
if ($cfpEnable) {
    /** @var \Mageplaza\CallForPrice\Helper\Rule $cfpHelperRule */
    $cfpHelperRule = $block->getCfpHelperRule();
}

if ($rfqShow) {
    /** @var \Mageplaza\RequestForQuote\Helper\Data $rfqHelper */
    $rfqHelper = $block->getRfqHelper();
}
?>
<?php if ($_productCollection->count()) : ?>
    <?= $block->getToolbarHtml() ?>
    <?= $block->getAdditionalHtml() ?>
    <?php
    if ($block->getMode() === 'grid') {
        $viewMode = 'grid';
        $image = 'category_page_grid';
        $showDescription = false;
        $templateType = ReviewRendererInterface::SHORT_VIEW;
    } elseif ($block->getMode() === 'list') {
        $viewMode = 'list';
        $image = 'category_page_list';
        $showDescription = true;
        $templateType = ReviewRendererInterface::FULL_VIEW;
    }
    if ($block->getMode() !== 'table') :
        /**
         * Position for actions regarding image size changing in vde if needed
         */
        $pos = $block->getPositioned();
        ?>
        <div class="products wrapper <?= $block->escapeHtmlAttr($viewMode) ?>
         products-<?= $block->escapeHtmlAttr($viewMode) ?>">
            <?php $iterator = 1; ?>
            <ol class="products list items product-items">
                <?php /** @var Product $_product */ ?>
                <?php foreach ($_productCollection as $_product) : ?>
                    <?= /* @noEscape */
                    ($iterator++ === 1)
                        ? '<li class="item product product-item">'
                        : '</li><li class="item product product-item">' ?>
                    <div class="product-item-info" data-container="product-<?= $block->escapeHtmlAttr($viewMode) ?>">
                        <?php
                        $productImage = $block->getImage($_product, $image);
                        if ($pos) {
                            $position = ' style="left:' . $productImage->getWidth() . 'px;'
                                . 'top:' . $productImage->getHeight() . 'px;"';
                        }
                        ?>
                        <a href="<?= $block->escapeUrl($_product->getProductUrl()) ?>"
                           class="product photo product-item-photo" tabindex="-1">
                            <?= $productImage->toHtml() ?>
                        </a>
                        <div class="product details product-item-details">
                            <?php
                            $_productNameStripped = $block->stripTags($_product->getName(), null, true);
                            ?>
                            <strong class="product name product-item-name">
                                <a class="product-item-link"
                                   href="<?= $block->escapeUrl($_product->getProductUrl()) ?>">
                                    <?= $block->escapeHtml(
                                        $_helper->productAttribute(
                                            $_product,
                                            $_product->getName(),
                                            'name'
                                        )
                                    ) ?>
                                </a>
                            </strong>
                            <?= $block->getReviewsSummaryHtml($_product, $templateType) ?>
                            <?= /* @noEscape */
                            $block->getProductPrice($_product) ?>
                            <?= $block->getProductDetailsHtml($_product) ?>

                            <div class="product-item-inner">
                                <div class="product actions product-item-actions"
                                    <?= /* @noEscape */
                                    strpos($pos ?: '', $viewMode . '-actions') ? $position : '' ?>>
                                    <div class="actions-primary"
                                        <?= /* @noEscape */
                                        strpos($pos ?: '', $viewMode . '-primary') ? $position : '' ?>>
                                        <?php if ($_product->isSaleable()) : ?>
                                            <?php $postParams = $block->getAddToCartPostParams($_product); ?>
                                            <form data-role="tocart-form"
                                                  data-product-sku="<?= $block->escapeHtml($_product->getSku()) ?>"
                                                  action="<?= $block->escapeHtmlAttr($postParams['action']) ?>"
                                                  method="post">
                                                <input type="hidden" name="product"
                                                       value="<?= /* @noEscape */
                                                       $postParams['data']['product'] ?>">
                                                <input type="hidden"
                                                       name="<?= /* @noEscape */
                                                       Action::PARAM_NAME_URL_ENCODED ?>"
                                                       value="<?= /* @noEscape */
                                                       $postParams['data'][Action::PARAM_NAME_URL_ENCODED] ?>">
                                                <?= $block->getBlockHtml('formkey') ?>
                                                <button type="submit"
                                                        title="<?= $block->escapeHtmlAttr(__('Add to Cart')) ?>"
                                                        class="action tocart primary">
                                                    <span><?= $block->escapeHtml(__('Add to Cart')) ?></span>
                                                </button>
                                            </form>
                                        <?php else : ?>
                                            <?php if ($_product->isAvailable()) : ?>
                                                <div class="stock available">
                                                    <span><?= $block->escapeHtml(__('In stock')) ?></span>
                                                </div>
                                            <?php else : ?>
                                                <div class="stock unavailable">
                                                    <span><?= $block->escapeHtml(__('Out of stock')) ?></span>
                                                </div>
                                            <?php endif; ?>
                                        <?php endif; ?>
                                    </div>
                                    <div data-role="add-to-links" class="actions-secondary"
                                        <?= /* @noEscape */
                                        strpos($pos ?: '', $viewMode . '-secondary') ? $position : '' ?>>
                                        <?php if ($addToBlock = $block->getChildBlock('addto')) : ?>
                                            <?= $addToBlock->setProduct($_product)->getChildHtml() ?>
                                        <?php endif; ?>
                                    </div>
                                </div>
                                <?php if ($showDescription) : ?>
                                    <div class="product description product-item-description">
                                        <?= $block->escapeHtml(
                                            $_helper->productAttribute(
                                                $_product,
                                                $block->stripTags($_product->getShortDescription()),
                                                'short_description'
                                            )
                                        ) ?>
                                        <a href="<?= $block->escapeUrl($_product->getProductUrl()) ?>"
                                           title="<?= $block->escapeHtmlAttr($_productNameStripped) ?>"
                                           class="action more"><?= $block->escapeHtml(__('Learn More')) ?></a>
                                    </div>
                                <?php endif; ?>
                            </div>
                        </div>
                    </div>
                    <?= ($iterator === count($_productCollection) + 1) ? '</li>' : '' ?>
                <?php endforeach; ?>
            </ol>
        </div>
        <?= $block->getChildBlock('toolbar')->setIsBottom(true)->toHtml() ?>
        <?php if (!$block->isRedirectToCartEnabled()) : ?>
        <script type="text/x-magento-init">
                {
                    "[data-role=tocart-form], .form.map.checkout": {
                        "catalogAddToCart": {
                            "product_sku": "<?= /** noEscape */
            $_product->getSku() ?>"
                        }
                    }
                }


        </script>
    <?php endif; ?>
    <?php else :
        $viewMode = 'table';
        $image = 'category_page_list';
        $showDescription = true;
        $templateType = ReviewRendererInterface::SHORT_VIEW;
        $pos = $block->getPositioned(); ?>
        <?php
        /** @var Product $_product */
        foreach ($_productCollection as $_product) : ?>

        <?php endforeach; ?>
        <div class="products wrapper <?= $block->escapeHtmlAttr($viewMode) ?>
         products-<?= $block->escapeHtmlAttr($viewMode) ?>">
            <style>
                @media only screen and (max-width: 760px),
                (min-device-width: 768px) and (max-device-width: 1024px) {
                    div.table {
                        overflow: auto;
                    }
                }
            </style>
            <?php $iterator = 1; ?>
            <ol class="products list items">
                <?php if ($block->checkEnable('add_button')) : ?>
                    <div class="mptablecategory-add-all">
                        <button type="button">
                            <?= $block->getButtonInf('text') ?: $block->escapeHtml(__('Add')) ?></button>
                    </div>
                    <div id="mptablecategory-add-all-popup"></div>
                <?php endif; ?>

                <div class="table-responsive">



                    <div class="divTable">
                        <div class="divTableBody" id="mptablecategory-table-view">
                            <?php
                            /** @var Product $_product */

                            $count = 0;
                            foreach ($_productCollection as $_product) : ?>
                                <?php

                                ++$count;
                                if ($count % 2) {
                                    $class = "odd";
                                } else {
                                    $class = "even";
                                }

                                if ($cfpEnable) {
                                    $validateProductInRule = $cfpHelperRule->validateProductInRuleAvailable($_product->getId());
                                    $showAddToCartButton = true;
                                    if ($validateProductInRule) {
                                        $showAddToCartButton = false;
                                    }
                                }
                                ?>


                                <div class="divTableRow product-item-info <?php echo $class; ?>"
                                     data-container="product-grid" data-productid="<?= /* @noEscape */  $_product->getId() ?>">
                                    <div class="divTableCell image">

                                            <div class="owl-carousel" style=" display: block;" dir="rtl">

                                                <?php  $imageUrl0 = $block->getImage($_product, 'category_page_list')->getImageUrl(); ?>

                                                <img src="<?php echo $imageUrl0; ?>"  class="product-image">

                                                <?php

                                                if ($_product->getTypeId() == 'configurable') {

                                                    $usedProducts =$_product->getTypeInstance()->getUsedProducts($_product);

                                                    foreach ($usedProducts as $simpleProduct) {

                                                        $imageUrl = $block->getImage($simpleProduct, 'category_page_list')->getImageUrl();

                                                        ?>

                                                        <img src="<?php echo $imageUrl; ?>" style="display:none;" class="product-image">

                                                        <?php
                                                    }
                                                }

                                                ?>


                                            </div>


                                       </div>
                                    <div class="divTableCell actions">
                                        <div data-role="add-to-links" class="actions-secondary">
                                            <?php if ($addToBlock = $block->getChildBlock('addto')): ?>
                                                <?= $addToBlock->setProduct($_product)->getChildHtml() ?>
                                            <?php endif; ?>
                                        </div>

                                    </div>
                                    <div class="divTableCell title">
                                        <?php
                                        $_productNameStripped = $block->stripTags($_product->getName(), null, true);
                                        ?>
                                        <a class="product-item-link"
                                           href="<?= $block->escapeUrl($_product->getProductUrl()) ?>">
                                            <?= $block->escapeHtml(
                                                $_helper->productAttribute(
                                                    $_product,
                                                    $_product->getName(),
                                                    'name'
                                                )
                                            ) ?>
                                        </a>
                                        <div class="product-attributes">

                                            <?= $block->getConfigurableOptionsHtml($_product) ?>

                                        </div>
                                        <div>
                                            <?php
                                            if ($_product->getAttributeText('manufacturer')) {
                                                echo '<span class="badge badge-primary marque">' . $_product->getAttributeText('manufacturer') . '</span>';
                                            }
                                            ?>
                                        </div>

                                        <div class="sku">

                                            Réf : <?= $block->escapeHtml($_product->getSku()) ?>
                                        </div>

                                    </div>
                                    <div class="divTableCell mptablecategory-product-option">
                                       <?php //echo $_product->getTypeId() ?>

                                        <?php if ($block->isPopup($_product)) : ?>
                                            <?php if ($block->checkPopup($_product)) : ?>
                                                <a class="mptablecategory-popup-click">
                                                    <?= $block->escapeHtml(__('Voir déclinaisons')) ?>
                                                </a>
                                            <?php else : ?>
                                                <div class="mptablecategory-no-options">
                                                    <?= $block->escapeHtml(__('No Options To Select')) ?>
                                                </div>
                                            <?php endif; ?>
                                        <?php else : ?>
                                            <form class="mp-product-options">
                                                <?php if ($block->getProductDetailsHtml($_product) !== '') : ?>
                                                    <div class="mp-product-attribute">

                                                        <?= $block->getProductDetailsHtml($_product) ?>
                                                    </div>
                                                <?php endif; ?>
                                                <?php if ($block->setMpProduct($_product->getId())) : ?>
                                                    <div class="mp-product-customizable">
                                                <span class="options-title"
                                                      id="<?= $_product->getId() ?>"><?= $block->escapeHtml(__('Contenu du pack')) ?></span>
                                                        <?= /* @noEscape */
                                                        $block->getOptionsHtml() ?>
                                                        <?= /* @noEscape */
                                                        $block->getLinksHtml($_product) ?>
                                                        <?= /* @noEscape */
                                                        $block->getGroupProductHtml($_product) ?>
                                                        <?= /* @noEscape */
                                                        $block->getBundleHtml($_product) ?>
                                                        <?= /* @noEscape */
                                                        $block->getGiftCardHtml($_product) ?>
                                                    </div>
                                                <?php endif; ?>
                                                <?php if ($block->getProductDetailsHtml($_product) === ''
                                                    && !$block->setMpProduct($_product->getId())) : ?>
                                                    <div class="mptablecategory-no-options">
                                                        <?= $block->escapeHtml(__('No Options To Select')) ?>
                                                    </div>
                                                <?php endif; ?>
                                            </form>
                                        <?php endif; ?>


                                        <?php //$related= $_product->getRelatedProducts();
                                        $related = array(); ?>
                                        <?php foreach($related as $_item): ?>

                                        <?php

                                        $imageUrl = $block->getImage($_item, 'product_base_image')->getImageUrl();

                                        ?>
                                        <ul class="mini-products-list" id="block-related">
                                            <li class="item">

                                                <?php if(!$_item->isComposite() && $_item->isSaleable()): ?>
                                                    <?php if (!$_item->getRequiredOptions()): ?>

                                                    <?php endif; ?>
                                                <?php endif; ?>

                                                <div class="product">
                                                    <a href="<?php echo $_item->getProductUrl() ?>"><img src="<?php echo $imageUrl;  ?>" width="80" height="80" /></a>
                                                    <div class="product-details">
                                                        <p class="product-name">
                                                            <a href="<?php echo $_item->getProductUrl() ?>"><?php echo $_item->getName(); ?></a></p>
                                                        <p class="sku"><?php echo $_item->getSku()?></p>

                                                    </div>
                                                </div>
                                            </li>

                                            <?php endforeach ?>
                                        </ul>



                                    </div>
                                    <div class="divTableCell price">
                                        <?= /** noEscape */
                                        $block->getProductPrice($_product) ?>


                                        <?php
                                        if ($_product->getTypeId() == 'configurable') {

                                            $basePrice = $_product->getPriceInfo()->getPrice('regular_price');
                                            $price = $basePrice->getMinRegularAmount()->getValue();
                                            $price_final = $_product->getFinalPrice();

                                            if($price_final < $price){
                                                ?>
                                                <?php
                                                $sale = round(($price-$price_final)/$price*100);
                                                ?>
                                             <span class="onsale label-product">-<?php echo $sale; ?>%</span>
                                                <?php

                                            }
                                        } else if($_product->getTypeId() == 'simple'){
                                            $price = $_product->getPrice();
                                            $price_final = $_product->getFinalPrice();
                                            if($price_final < $price){
                                                ?>
                                                <?php
                                                $sale = round(($price-$price_final)/$price*100);
                                                ?>
                                                <span class="onsale label-product">-<?php echo $sale; ?>%</span>
                                                <?php

                                            }

                                        }
                                        ?>
                                        <?php

                                        $toDate = time();
                                        $fromDate = $_product->getData('end_date_in_stock');
                                        if ($fromDate && $fromDate != '' && strtotime($fromDate) >= $toDate) {

                                            if (1) {


                                                ?>
                                                <div class="countdown-page-product-custom">
                                                    <div class="des-countdown-p-p-c"><p class="message"><i
                                                                    class="fas fa-fire"></i><?= $block->escapeHtml('Hurry up!') ?> <?= $block->escapeHtml('Sale end in:') ?>
                                                        </p></div>
                                                    <div id="countbox-p-p-c-container"
                                                         class="countbox-p-p-c-container countbox-p-p-c-container-<?php echo($_product->getId()); ?>"></div>
                                                </div>
                                                <script type="text/javascript">
                                                    require(["jquery", "countdown"], function ($) {
                                                        $(document).ready(function () {
                                                            var $thisCountdown = $('.countbox-p-p-c-container-<?php echo($_product->getId()); ?>'),
                                                                finalDate = '<?= $fromDate ?>';
                                                            $thisCountdown.countdown(finalDate, function (event) {
                                                                $thisCountdown.html(event.strftime(''
                                                                    + '<span class="countdown-days"><span class="countdown_ti">%-D</span></span>j '
                                                                    + '<span class="countdown-hours"><span class="countdown_ti">%H</span></span>h '
                                                                    + '<span class="countdown-min"><span class="countdown_ti">%M</span></span>m '
                                                                    + '<span class="countdown-sec"><span class="countdown_ti">%S</span></span>s'));
                                                            });
                                                        });
                                                    });
                                                </script> <?php
                                            }
                                        }
                                        ?>
                                        <?php
                                        $conditionnement = $_product->getResource()->getAttribute('conditionnement');
                                        $conditionnemen = $conditionnement->getSource()->getOptionText($_product->getData('conditionnement'));

                                        if(is_array($conditionnement)){

                                            foreach($conditionnement as $conditionnement){
                                                ?>
                                                <a href="#" data-conditionnemment="<?php echo $conditionnement; ?>" class="add">
                                                    <img src="/media/icons/carton.png"> <?php echo $conditionnement; ?>pcs
                                                </a>
                                            <?php  }  } ?>
                                    </div>
                                    <div class="divTableCell mptablecategory-product-qty">
                                        <?php if ($block->isQty($_product)) : ?>
                                         <?php if ($_product->isAvailable()) : ?>
                                            <input type="number" value="1" min="0"
                                                   class="mptablecategory-qty-input mpcpgv-input">
                                            <?php endif; ?>
                                        <?php endif; ?>


                                        <?php if ($block->checkEnable('stock')) : ?>

                                            <?php if ($_product->isAvailable()) : ?>


                                                <?php


                                                $precommande = $_product->getPreOrderStatus();

                                                if($precommande == '1'){ ?>
                                                    <div class="preorder-button">Précommande</div>

                                             <?php
                                            } else {



                                                ?>
                                                <div class="stock "
                                                     title="<?= $block->escapeHtmlAttr(__('Availability')) ?>">

                                                    <?= $block->escapeHtml(__('Stock')) ?>
                                                    : <?= $block->getProductStockQty($_product) ?: '' ?>

                                                </div>
  <?php
                                            }



                                                ?>
                                            <?php else : ?>
                                                <div class="stock unavailable"
                                                     title="<?= $block->escapeHtmlAttr(__('Availability')) ?>">
                                                    <span><?= $block->escapeHtml(__('Out of stock')) ?></span>
                                                </div>
                                            <?php endif; ?>


                                        <?php endif; ?>

                                        <?php

                                        $objectManager = \Magento\Framework\App\ObjectManager::getInstance();
                                        $estimated_delivery = $_product->getResource()->getAttribute('estimated_delivery')->getFrontend()->getValue($_product);

                                        ?>
                                        <div class="entry-product-meta-shipping" style="margin-top: 6px">
                                            <?php if ($estimated_delivery) { ?>
                                                <?php
                                                $date = date('Y-m-j');
                                                $newdate = strtotime('+' . $estimated_delivery . ' day', strtotime($date));
                                                $newdate = date('j/m/Y', $newdate);
                                                ?>
                                                <div class="item product-meta-shipping-delivery-time">
                                                    <div class="icon me-3" style="font-size: 14px;display: table-cell;">
                                                        <svg width="20" xmlns="http://www.w3.org/2000/svg"
                                                             viewBox="0 0 640 512">
                                                            <path d="M280 192c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H40c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240zm352 192h-24V275.9c0-16.8-6.8-33.3-18.8-45.2l-83.9-83.9c-11.8-12-28.3-18.8-45.2-18.8H416V78.6c0-25.7-22.2-46.6-49.4-46.6H113.4C86.2 32 64 52.9 64 78.6V96H8c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8H96V78.6c0-8.1 7.8-14.6 17.4-14.6h253.2c9.6 0 17.4 6.5 17.4 14.6V384H207.6C193 364.7 170 352 144 352c-18.1 0-34.6 6.2-48 16.4V288H64v144c0 44.2 35.8 80 80 80s80-35.8 80-80c0-5.5-.6-10.8-1.6-16h195.2c-1.1 5.2-1.6 10.5-1.6 16 0 44.2 35.8 80 80 80s80-35.8 80-80c0-5.5-.6-10.8-1.6-16H632c4.4 0 8-3.6 8-8v-16c0-4.4-3.6-8-8-8zm-488 96c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm272-320h44.1c8.4 0 16.7 3.4 22.6 9.4l83.9 83.9c.8.8 1.1 1.9 1.8 2.8H416V160zm80 320c-26.5 0-48-21.5-48-48s21.5-48 48-48 48 21.5 48 48-21.5 48-48 48zm80-96h-16.4C545 364.7 522 352 496 352s-49 12.7-63.6 32H416v-96h160v96zM256 248v-16c0-4.4-3.6-8-8-8H8c-4.4 0-8 3.6-8 8v16c0 4.4 3.6 8 8 8h240c4.4 0 8-3.6 8-8z"></path>
                                                        </svg> <?= $newdate ?></div>

                                                </div>
                                            <?php } ?>

                                        </div>


                                    </div>
                                    <div class="divTableCell" style="width:150px">
                                           <?php if ($_product->isAvailable()) : ?>
                                        <input type="hidden"
                                               value="<?= $block->escapeHtmlAttr($_product->getTypeId()) ?>"
                                               class="mptablecategory-product-type">
                                        <?php if ($cfpEnable) : ?>
                                            <?php if ($showAddToCartButton) : ?>
                                            <?php if ($block->checkEnable('add_button')) : ?>
                                        <input type="checkbox" class="mptablecategory-checkbox">
                                        <?php else : ?>
                                            <button class="mptablecategory-add-each"
                                                    product-id="<?= $block->escapeHtmlAttr($_product->getId()) ?>"
                                                    type="button">
                                                <?= $block->getButtonInf('text') ?: $block->escapeHtml(__('Add')) ?>
                                            </button>
                                            <script type="text/x-magento-init">
                                                {
                                                    ".product-item-info[data-productid='<?= /* @noEscape */
                                                $_product->getId() ?>']": {
                                                                "Mageplaza_TableCategoryView/js/add-each-product": {
                                                                    "url": "<?= /* @noEscape */
                                                $block->getUrl('mptablecategory/cart/addeach') ?>",
                                                                    "storeId": <?= /* @noEscape */
                                                $block->getStoreId() ?>,
                                                                    "optionsValue": <?= /* @noEscape */
                                                $block->getOptions($_product->getId()) ?>,
                                                                    "mpUrl": "<?= /* @noEscape */
                                                $block->getUrl('mpcpgv/cart/addtocart') ?>"
                                                        }
                                                    }
                                                }

                                            </script>
                                        <?php endif; ?>
                                        <?php else : ?>
                                            <?php if ($rfqShow && !$showAddToCartButton) : ?>
                                                <?= $block->escapeHtml(__('No Action')) ?>
                                            <?php endif; ?>
                                        <?php endif; ?>
                                        <?php else : ?>
                                        <?php if ($block->checkEnable('add_button')) : ?>
                                        <input type="checkbox" class="mptablecategory-checkbox">
                                        <?php else : ?>
                                                <?php if ($_product->getTypeId() != 'configurable') : ?>
                                            <button class="mptablecategory-add-each"
                                                    product-id="<?= $block->escapeHtmlAttr($_product->getId()) ?>"
                                                    type="button">
                                                <?= $block->getButtonInf('text') ?: $block->escapeHtml(__('Add')) ?>
                                            </button>
                                            <script type="text/x-magento-init">
                                            {
                                                ".product-item-info[data-productid='<?= /* @noEscape */
                                                $_product->getId() ?>']": {
                                                    "Mageplaza_TableCategoryView/js/add-each-product": {
                                                        "url": "<?= /* @noEscape */
                                                $block->getUrl('mptablecategory/cart/addeach') ?>",
                                                        "storeId": <?= /* @noEscape */
                                                $block->getStoreId() ?>,
                                                        "optionsValue": <?= /* @noEscape */
                                                $block->getOptions($_product->getId()) ?>,
                                                        "mpUrl": "<?= /* @noEscape */
                                                $block->getUrl('mpcpgv/cart/addtocart') ?>"
                                                    }
                                                }
                                            }

                                            </script>
                                           <?php endif; ?>
                                        <?php endif; ?>
                                        <?php endif; ?>
                                        <?php if ($rfqShow) : ?>
                                            <?= $block->getBlockHtml('formkey') ?>
                                            <button type="submit" title="Add to Quote" class="action toquote">
                                                <img src="<?= $block->escapeUrl($rfqHelper->getButtonIconUrl()) ?>"
                                                     alt="<?= $block->escapeHtmlAttr(__('Cart Quote Icon')) ?>"/>
                                            </button>
                                        <?php endif; ?>

                                           <?php endif; ?>
                                    </div>
                                </div>

                                <div class="divTableRow"
                                     id="mptablecategory-popup-<?= /* @noEscape */
                                     $_product->getId() ?>"></div>


                            <?php endforeach; ?>

                        </div>
                    </div>


                </div>
            </ol>
        </div>
        <?= $block->getChildBlock('toolbar')->setIsBottom(true)->toHtml() ?>
    <?php endif; ?>
<?php else : ?>
    <div class="message info empty">
        <div><?= $block->escapeHtml(__('We can\'t find products matching the selection.')) ?> </div>
    </div>
<?php endif; ?>
<script type="text/x-magento-init">
    {
        "*": {
            "Mageplaza_TableCategoryView/js/popup": {
                "url": "<?= /* @noEscape */
    $block->getUrl('mptablecategory/catalog/productoptions') ?>",
                "storeId": <?= /* @noEscape */
    $block->getStoreId() ?>
            },
            "Mageplaza_TableCategoryView/js/add-all-to-cart": {
                "url": "<?= /* @noEscape */
    $block->getUrl('mptablecategory/cart/addalltocart') ?>",
                "urlToQuote": "<?= /* @noEscape */
    $block->getUrl('mprequestforquote/cart_quote/add') ?>",
                "storeId": <?= /* @noEscape */
    $block->getStoreId() ?>,
                "optionsValue": <?= /* @noEscape */
    $block->getAllProductOptions() ?>,
                "isLogin": <?= /* @noEscape */
    $block->isLogin() ?: 'false' ?>
            }
        }
    }


</script>


<script>// <![CDATA[
    require([
        'jquery',
        'slick'
    ], function ($, script) {
        $(document).ready(function() {

            $("a.add").click(function(event)
            {

                event.preventDefault();

                let conditionnemment = $(this).data('conditionnemment');
                let div = $(this).closest('div.divTableRow');
                let currentVal =  parseInt(div.find('input').val());
                let myinput = div.find('input');

                if (currentVal == '1')
                {
                    myinput.val(conditionnemment);

                } else {

                    myinput.val(currentVal + conditionnemment);
                }

                /*
                let conditionnemment = $(this).data('conditionnemment');
                let div = $(this).closest('div.divTableRow');
                let currentVal =  parseInt(div.find('input').val());
                let myinput = div.find('input');



                if (currentVal != NaN)
                {
                    myinput.val(currentVal + conditionnemment);

                }
                */

            });




            $('.owl-carousel').slick({
                infinite: true,
                slidesToShow: 1,
                slidesToScroll: 1,
                autoplay: true,
                rtl: true,
                autoplaySpeed:6000,
                pauseOnFocus: true,
                pauseOnHover: true,
            });
        });
    });
    // ]]>
</script>


<style>

    <?php if ($block->checkTheme()) : ?>

    .mode-table:before {
        display: inline-block;
        content: '';
    }

    .mptablecategory-product-option .swatch-attribute-options {
        width: 100%;
    }

    .modes strong.mode-table, .modes a.mode-table {
        padding: 0 7px;
        background-image: url('<?= /* @noEscape */ $block->getViewFileUrl('Mageplaza_TableCategoryView::images/table-icon.svg') ?>');
        background-repeat: no-repeat;
        background-size: 16px;
        background-position: center;
    }

    .modes-mode.mode-table:hover {
        padding: 0 7px;
        background-image: url('<?=  /* @noEscape */ $block->getViewFileUrl('Mageplaza_TableCategoryView::images/table-icon.svg') ?>');
        background-repeat: no-repeat;
        background-size: 16px;
        background-position: center;
    }

    <?php else :?>
    .mode-table:before {
        display: inline-block;
        content: '';
    }

    .modes strong.mode-table, .modes a.mode-table {
        padding: 8px 17px;
        background-image: url('<?= /* @noEscape */ $block->getViewFileUrl('Mageplaza_TableCategoryView::images/table-icon.svg') ?>');
        background-repeat: no-repeat;
        background-size: 19px;
        background-position: center;
    }

    .modes-mode.mode-table:hover {
        background-image: url('<?= /* @noEscape */ $block->getViewFileUrl('Mageplaza_TableCategoryView::images/table-icon.svg') ?>');
        background-size: 19px;
        background-repeat: no-repeat;
        background-position: center;
    }

    <?php endif;?>
</style>


